import numpy as np
from scipy import stats
from cliffs_delta import cliffs_delta
import pandas as pd

# 定义数据，按比例组织
data = {
    "svhn_vgg16": {
        "ratio": {
            "ours": [0.2650602410,0.3373493976,0.3614457831,0.4819277108,0.5301204819],
            "NAC": [0.0722891566,0.1204819277,0.1445783133,0.1686746988,0.2771084337],
            "NBC": [0.0602409639,0.0963855422,0.1445783133,0.1686746988,0.2650602410],
            "SNAC": [0.1204819277,0.1204819277,0.1566265060,0.1807228916,0.2168674699],
            "TKNC": [0.0722891566,0.1204819277,0.1445783133,0.1686746988,0.2771084337],
            "drop-out": [0.2530120482,0.2891566265,0.3493975904,0.4457831325,0.5180722892],
            "maxp": [0.2168674699,0.3012048193,0.3493975904,0.4578313253,0.5301204819],
            "DeepGini": [0.2409638554,0.3012048193,0.3493975904,0.4578313253,0.5301204819],
            "Margin": [0.2530120482,0.2650602410,0.3493975904,0.4578313253,0.5421686747],
            "Random": [0.0722891566,0.1204819277,0.1325301205,0.1325301205,0.1686746988],
            "ATS": [0.2289156627,0.3253012048,0.3493975904,0.4216867470,0.4698795181],
            "DATIS": [0.2409638554,0.3253012048,0.3614457831,0.4698795181,0.5180722892]
        }
    },
    "svhn_lenet5": {
        "ratio": {
            "ours": [0.3464052288,0.4771241830,0.5294117647,0.6078431373,0.7581699346],
            "NAC": [0.0980392157,0.1437908497,0.1895424837,0.2483660131,0.3137254902],
            "NBC": [0.0980392157,0.1241830065,0.1568627451,0.1960784314,0.2614379085],
            "SNAC": [0.0588235294,0.0915032680,0.1241830065,0.1503267974,0.2352941176],
            "TKNC": [0.1045751634,0.1568627451,0.1960784314,0.2745098039,0.3202614379],
            "drop-out": [0.3071895425,0.3986928105,0.4771241830,0.5882352941,0.7254901961],
            "maxp": [0.2222222222,0.3529411765,0.4705882353,0.6013071895,0.7516339869],
            "DeepGini": [0.2222222222,0.3660130719,0.4575163399,0.5882352941,0.7516339869],
            "Margin": [0.2352941176,0.3529411765,0.4705882353,0.5816993464,0.7385620915],
            "Random": [0.0915032680,0.1176470588,0.1503267974,0.2026143791,0.2614379085],
            "ATS": [0.2352941176,0.3464052288,0.4117647059,0.5228758170,0.6862745098],
            "DATIS": [0.3464052288,0.4771241830,0.5294117647,0.6078431373,0.7516339869]
        }
    },
    "fashion_lenet1": {
        "ratio": {
            "ours": [0.3253012048,0.4939759036,0.6024096386,0.7228915663,0.8313253012],
            "NAC": [0.1325301205,0.2168674699,0.2530120482,0.3253012048,0.4578313253],
            "NBC": [0.0963855422,0.1686746988,0.2409638554,0.3132530120,0.4337349398],
            "SNAC": [0.0602409639,0.1325301205,0.1445783133,0.2048192771,0.2771084337],
            "TKNC": [0.1325301205,0.2168674699,0.2530120482,0.3253012048,0.4578313253],
            "drop-out": [0.3975903614,0.4578313253,0.5903614458,0.6987951807,0.7851807229],
            "maxp": [0.3132530120,0.5060240964,0.5662650602,0.6987951807,0.8072289157],
            "DeepGini": [0.3253012048,0.4698795181,0.5662650602,0.6385542169,0.8072289157],
            "Margin": [0.3253012048,0.4337349398,0.5542168675,0.7108433735,0.8072289157],
            "Random": [0.1325301205,0.1686746988,0.2168674699,0.3012048193,0.4337349398],
            "ATS": [0.3493975900,0.4216867470,0.4819277110,0.5783132530,0.7108433730],
            "DATIS": [0.3253012048,0.4939759036,0.5783132530,0.6987951807,0.8192771084]
        }
    },
    "fashion_resnet20": {
        "ratio": {
            "ours": [0.5714285714,0.7857142857,0.7857142857,0.8571428571,0.9642857143],
            "NAC": [0.2142857143,0.3214285714,0.3928571429,0.5000000000,0.6428571429],
            "NBC": [0.1428571429,0.2857142857,0.3928571429,0.5000000000,0.6071428571],
            "SNAC": [0.1071428571,0.2142857143,0.2857142857,0.4285714286,0.5357142857],
            "TKNC": [0.2142857143,0.3214285714,0.3928571429,0.5000000000,0.6428571429],
            "drop-out": [0.5714285714,0.7142857143,0.7142857143,0.8285714286,0.9642857143],
            "maxp": [0.5357142857,0.7500000000,0.8214285714,0.8214285714,0.8571428571],
            "DeepGini": [0.6071428571,0.7142857143,0.8214285714,0.8214285714,0.8571428571],
            "Margin": [0.5714285714,0.7500000000,0.7857142857,0.8214285714,0.8928571429],
            "Random": [0.2500000000,0.3214285714,0.4285714286,0.5000000000,0.5714285714],
            "ATS": [0.6071428571,0.6785714286,0.7500000000,0.8214285714,0.9285714286],
            "DATIS": [0.6071428571,0.7142857143,0.7857142857,0.8571428571,0.9642857143]
        }
    },
    "cifar100_resnet32": {
        "ratio":{
                "ours": [0.8100000000, 0.7200000000, 0.6666666667, 0.5460000000, 0.7276341948],
                "NAC": [0.3400000000, 0.3000000000, 0.2966666667, 0.2520000000, 0.4671968191],
                "NBC": [0.2600000000, 0.2250000000, 0.2333333333, 0.2260000000, 0.3677932406],
                "SNAC": [0.2000000000, 0.1800000000, 0.1566666667, 0.1540000000, 0.2664015905],
                "TKNC": [0.3400000000, 0.3000000000, 0.2966666667, 0.2520000000, 0.4671968191],
                "drop-out": [0.6600000000, 0.6150000000, 0.5733333333, 0.5040000000, 0.7077534791],
                "maxp": [0.7600000000, 0.6450000000, 0.5900000000, 0.4940000000, 0.6878727634],
                "DeepGini": [0.7200000000, 0.6700000000, 0.6166666667, 0.5000000000, 0.6898608350],
                "Margin": [0.6800000000, 0.5750000000, 0.5133333333, 0.4300000000, 0.6998011928],
                "Random": [0.3100000000, 0.3050000000, 0.2866666667, 0.2620000000, 0.4274353877],
                "ATS": [0.6900000000, 0.6450000000, 0.5733333333, 0.4880000000, 0.6878727634],
                "DATIS": [0.8000000000, 0.7100000000, 0.6533333333, 0.5420000000, 0.7256461233]
        }
        },
    "cifar10_vgg16": {
        "ratio":{
                "ours": [0.2000000000,0.1830065360,0.2156862750,0.3267973860,0.4509803920],
                "NAC": [0.1100000000,0.0849673203,0.1176470588,0.1437908497,0.1699346405],
                "NBC": [0.1000000000,0.0784313725,0.1111111111,0.1372549020,0.1633986928],
                "SNAC": [0.0700000000,0.0784313725,0.1111111111,0.1241830065,0.1568627451],
                "TKNC": [0.1100000000,0.0849673203,0.1176470588,0.1437908497,0.1699346405],
                "drop-out": [0.2000000000,0.1699346410,0.2483660130,0.3071895420,0.4117647060],
                "maxp": [0.1900000000,0.1699346410,0.2352941180,0.3464052290,0.4110429450],
                "DeepGini": [0.2000000000,0.2026143791,0.2287581699,0.3464052288,0.4509803920],
                "Margin": [0.1500000000,0.1699346405,0.2352941176,0.3333333333,0.4509803920],
                "Random": [0.0800000000,0.0653594771,0.0718954248,0.0915032680,0.1437908497],
                "ATS": [0.1800000000,0.1568627451,0.2156862745,0.3006535948,0.4183006536],
                "DATIS": [0.1800000000,0.1764705882,0.2156862750,0.3137254902,0.4509803920]
        }
        },
    "cifar10_resnet20": {
        "ratio": {
            "ours": [0.4400000000, 0.3856209150, 0.4509803922, 0.5816993464, 0.7777777778],
            "NAC": [0.1600000000, 0.1437908497, 0.2091503268, 0.3398692810, 0.5163398693],
            "NBC": [0.1800000000, 0.1960784314, 0.2352941176, 0.3464052288, 0.5098039216],
            "SNAC": [0.1100000000, 0.1437908497, 0.2026143791, 0.2679738562, 0.4379084967],
            "TKNC": [0.1600000000, 0.1437908497, 0.2091503268, 0.3398692810, 0.5163398693],
            "drop-out": [0.3600000000, 0.3398692810, 0.4117647059, 0.5424836601, 0.7647058824],
            "maxp": [0.4000000000, 0.3464052288, 0.4183006536, 0.5359477124, 0.7450980392],
            "DeepGini": [0.3900000000, 0.3464052288, 0.4248366013, 0.5555555556, 0.7450980392],
            "Margin": [0.3700000000, 0.3267973856, 0.4313725490, 0.5490196078, 0.6993464052],
            "Random": [0.1400000000, 0.1960784314, 0.2483660131, 0.3006535948, 0.4509803922],
            "ATS": [0.3000000000, 0.3464052288, 0.4248366013, 0.5620915033, 0.7254901961],
            "DATIS": [0.4000000000, 0.3660130719, 0.4444444444, 0.5882352941, 0.7712418301]
        }
    },
    "average": {
        "ratio": {
            "ours": [0.5272156863, 0.5272156863, 0.5417516340, 0.5677734205, 0.5872389252],
            "NAC": [0.2738300654, 0.2738300654, 0.2928017429, 0.3176368918, 0.3357179860],
            "NBC": [0.2935163399, 0.2935163399, 0.3124357298, 0.3318286129, 0.3479176955],
            "SNAC": [0.2324575163, 0.2324575163, 0.2528671024, 0.2710464779, 0.2824518276],
            "TKNC": [0.2738300654, 0.2738300654, 0.2928017429, 0.3176368918, 0.3357179860],
            "drop-out": [0.4837647059, 0.4837647059, 0.5043921569, 0.5318126362, 0.5518206245],
            "maxp": [0.4891503268, 0.4891503268, 0.5040087146, 0.5302759622, 0.5489385137],
            "DeepGini": [0.4923790850, 0.4923790850, 0.5094422658, 0.5366151053, 0.5552448560],
            "Margin": [0.4753071895, 0.4753071895, 0.4928583878, 0.5205352215, 0.5353956669],
            "Random": [0.2672156863, 0.2672156863, 0.2884183007, 0.3038082789, 0.3130486565],
            "ATS": [0.4717647059, 0.4717647059, 0.5003921569, 0.5260566449, 0.5429266521],
            "DATIS": [0.5139869281, 0.5139869281, 0.5329847495, 0.5608133624, 0.5802081820]
        }
    },
    # 你可以为其他数据集（如 cifar10 等）做类似的组织
}

# 计算每个数据集、每个比例、每个方法之间的 p 值和 Cliff's delta
def calculate_p_and_cliffs(data_dict):
    results = []
    for dataset, ratios in data_dict.items():
        for ratio, methods in ratios.items():
            for method, values in methods.items():
                if method != "ours":  # 比较"ours"与其他方法
                    p_value = stats.ttest_rel(methods["ours"], values)[1]  # p值
                    cliff_effect_size = cliffs_delta(methods["ours"], values)  # Cliff's delta
                    results.append({
                        "Dataset": dataset,
                        "Ratio": ratio,
                        "Method": method,
                        "p-value": p_value,
                        "Cliff's Delta": cliff_effect_size
                    })
    return results

# 计算 p 值和 Cliff's delta
results = calculate_p_and_cliffs(data)

# 输出结果
df = pd.DataFrame(results)
print(df)
df.to_csv("comparison_results.csv", index=False)